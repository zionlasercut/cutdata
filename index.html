<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>雷射切割機參數動態讀取</title>
  <style>
    body { font-family: Arial,sans-serif; margin:1rem; }
    select { font-size:1rem; padding:.5rem; margin:.5rem 0; }
    .table-container { overflow-x:auto; margin-top:1rem; }
    table { border-collapse:collapse; width:100%; min-width:400px; }
    th, td { border:1px solid #ccc; padding:.5rem; text-align:center; }
    th { background:#f0f0f0; }
  </style>
  <!-- SheetJS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
  <h1>雷射切割機參數動態讀取</h1>

  <label for="machineSelect">選擇機種：</label><br>
  <select id="machineSelect">
    <option value="">-- 請選擇 --</option>
  </select>

  <div id="tableArea" class="table-container"></div>

  <script>
    // 固定的機種清單
    const machines = ["Lasercut 1","Lasercut 2","Lasercut 3","XTool P2"];
    const sel = document.getElementById('machineSelect');
    const tableArea = document.getElementById('tableArea');
    let sheetData = null;  // 二維陣列

    // 1. 先把下拉選單填好
    machines.forEach(m=>{
      const opt = document.createElement('option');
      opt.value = m;
      opt.textContent = m;
      sel.appendChild(opt);
    });

    // 2. 讀取同目錄下 Data sheet
    window.addEventListener('DOMContentLoaded', async ()=>{
      try {
        const resp = await fetch('Laser.xlsx');
        if(!resp.ok) throw new Error(resp.statusText);
        const ab = await resp.arrayBuffer();
        const wb = XLSX.read(ab, {type:'array'});
        const ws = wb.Sheets["Data"];
        if(!ws) throw new Error("找不到工作表 Data");
        sheetData = XLSX.utils.sheet_to_json(ws, {header:1});
      } catch(err) {
        tableArea.textContent = "載入失敗： " + err.message;
      }
    });

    // 3. 使用者選機種後，從 sheetData 抽出該機種的「刀壓」「速度」兩欄
    sel.addEventListener('change', ()=>{
      tableArea.innerHTML = '';
      const m = sel.value;
      if(!m || !sheetData) return;

      const headers = sheetData[0];
      // indexOf 找到機種所在的欄位
      const idx = headers.indexOf(m);
      if(idx < 0) {
        tableArea.textContent = "工作表中沒有「" + m + "」這個標題";
        return;
      }
      // 假設「刀壓」「速度」連續兩欄
      const cols = [0, idx, idx+1];  

      // 建 table
      const tbl = document.createElement('table');
      const thead = document.createElement('thead');
      const trh = document.createElement('tr');
      cols.forEach(i=>{
        const th = document.createElement('th');
        th.textContent = headers[i] || '';
        trh.appendChild(th);
      });
      thead.appendChild(trh);
      tbl.appendChild(thead);

      const tbody = document.createElement('tbody');
      sheetData.slice(1).forEach(row=>{
        const tr = document.createElement('tr');
        cols.forEach(i=>{
          const td = document.createElement('td');
          td.textContent = row[i]!=null? row[i] : '';
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
      tbl.appendChild(tbody);
      tableArea.appendChild(tbl);
    });
  </script>
</body>
</html>
